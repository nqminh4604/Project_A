<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
<head th:replace="~{layout::page_head}"></head>
<body>
<div class="wrapper">
    <header class="header-sticky" th:replace="~{layout::page_header}"></header>
    <div class="slider-area slider-2">
        <div class="slider-activation owl-dot-style owl-carousel">
            <div class="single-slider pt-215 pb-257 bg-img"
                 style="background-image:url(/assets/img/slider/slider-bg-2.jpg);">
                <div class="container">
                    <div class="slider-content slider-animated-1">
                        <h1 class="first-h1 animated">New Exprience</h1>
                        <h1 class="second-h1 animated">For Traviling New </h1>
                        <h1 class="third-h1 animated">Places.</h1>
                        <h3 class="animated">360.00 <span>Full Package </span></h3>
                        <div class="slider-btn mt-75">
                            <a class="animated" th:href="@{/shop}">Shop Now <i
                                    class="animated icon-right-arrow"></i></a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="single-slider pt-215 pb-257 bg-img"
                 style="background-image:url(/assets/img/slider/slider-bg-3.jpg);">
                <div class="container">
                    <div class="slider-content slider-animated-2">
                        <h1 class="first-h1 animated">New Exprience</h1>
                        <h1 class="second-h1 animated">For Traviling New </h1>
                        <h1 class="third-h1 animated">Places.</h1>
                        <h3 class="animated">360.00 <span>Full Package </span></h3>
                        <div class="slider-btn mt-75">
                            <a class="animated" th:href="@{/shop}">Shop Now <i
                                    class="animated icon-right-arrow"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="slide-item-number"></div>
    </div>
    <!-- Slider Area End Here -->

    <!--Flash sale start -->
    <div class="container">
        <div class="flash-sale">
            <div class="row">
                <div class="col-6">
                    <h2><span style="color: yellow;"><i class="fa fa-bolt" aria-hidden="true"></i></span> Flash sale
                    </h2>
                </div>
                <div class="col-6">
                    <div class="countdown">
                        <div class="time">
                            <h5>2 days left</h5>
                        </div>
                    </div>
                </div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
                        <ol class="carousel-indicators">
                            <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                            <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                        </ol>
                        <div class="carousel-inner">
                            <!-- First carousel item (Always exists) -->
                            <div class="carousel-item active">
                                <div class="row">
                                    <div class="col-md-3 col-sm-6" th:each="product : ${firstGroup}">
                                        <div class="single-aboss-product">
                                            <div class="pro-img">
                                                <a th:href="@{/product-details(productId=${product.id})}">
                                                    <img th:src="${product.thumbnail != null ? product.thumbnail.filePath : 'default-image.jpg'}"
                                                         alt="Product Image">
                                                </a>
                                                <div class="pro-actions">
                                                </div>
                                            </div>
                                            <div class="pro-content">
                                                <h4><a th:href="@{/product-details(productId=${product.id})}" th:text="${product.name}"></a></h4>
                                                <div class="pro-price-cart">
                                                    <div class="pro-home-price">
                                                        <span th:text="'$' + ${product.price}"></span>
                                                    </div>
                                                    <div class="pro-cart">
<!--                                                        <a title="Add To Cart" th:href="@{/cart/add(id=${product.id})}">-->
<!--                                                            <i class="icon-cart"></i>-->
<!--                                                        </a>-->
                                                        <a  title="Add To Cart" href="javascript:void(0);" class="add-to-cart-btn" th:data-id="${product.id}">
                                                            <i class="icon-cart"></i>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Second carousel item (Only exists if there are more than 4 products) -->
                            <div class="carousel-item" th:if="${not #lists.isEmpty(secondGroup)}">
                                <div class="row">
                                    <div class="col-md-3 col-sm-6" th:each="product : ${secondGroup}">
                                        <div class="single-aboss-product">
                                            <div class="pro-img">
                                                <a th:href="@{/product-details(productId=${product.id})}">
                                                    <img th:src="${product.thumbnail != null ? product.thumbnail.filePath : 'default-image.jpg'}"
                                                         alt="Product Image">
                                                </a>
                                            </div>
                                            <div class="pro-content">
                                                <h4><a th:href="@{/product-details(productId=${product.id})}" th:text="${product.name}"></a></h4>
                                                <div class="pro-price-cart">
                                                    <div class="pro-home-price">
                                                        <span th:text="'$' + ${product.price}"></span>
                                                    </div>
                                                    <div class="pro-cart">
                                                        <a title="Add To Cart" th:href="@{/cart/add(id=${product.id})}">
                                                            <i class="icon-cart"></i>
                                                        </a>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--Flash sale end -->
    <!--Activities start -->
    <div class="banner-area pt-50">
        <div class="container">
            <div class="row">
                <div class="section-title text-center mb-45">
                    <h2>"Weâ€™re proud to journey with you, wherever you go"</h2>
                </div>
                <div class="col-lg-4 col-md-4">
                    <div class="hop-single-banner mb-30">
                        <img alt="" src="../../assets/img/banner/hop-banner-2.jpg">
                    </div>
                </div>
                <div class="col-lg-4 col-md-4">
                    <div class="hop-single-banner mb-30">
                        <img alt="" src="../../assets/img/banner/hop-banner-3.jpg">
                    </div>
                </div>
                <div class="col-lg-4 col-md-4">
                    <div class="hop-single-banner mb-30">
                        <img alt="" src="../../assets/img/banner/hop-banner-4.jpg">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--Activities end -->
<!--    <div class="best-seller-area pt-50 pb-90">-->
<!--        <div class="container">-->
<!--            <div class="section-title text-center mb-45">-->
<!--                <h2><i class="fa fa-star" aria-hidden="true"></i> RECOMMENDED FOR YOU <i class="fa fa-star"-->
<!--                                                                                         aria-hidden="true"></i></h2>-->
<!--            </div>-->
<!--            <div class="best-seller-active owl-carousel">-->
<!--                <div class="single-aboss-product" th:each="product : ${firstGroup}">-->
<!--                    <div class="pro-img">-->
<!--                        <a th:href="@{/product-details(productId=${product.getId()})}"><img-->
<!--                                th:src="${product.thumbnail != null ? product.thumbnail.filePath : 'default-image.jpg'}"-->
<!--                                alt="Product Image"></a>-->
<!--                        <div class="pro-actions">-->
<!--                        </div>-->
<!--                    </div>-->
<!--                    <div class="pro-content">-->
<!--                        <h4><a th:href="@{/product-details(productId=${product.getId()})}"-->
<!--                               th:text="${product.name}"></a></h4>-->
<!--                        <div class="pro-price-cart">-->
<!--                            <div class="pro-home-price">-->
<!--                                <span th:text="'$' + ${product.price}"></span>-->
<!--                            </div>-->
<!--                            <div class="pro-cart">-->
<!--                                <a title="Add To Cart" th:href="@{/cart/add(id=${product.id})}"><i-->
<!--                                        class="icon-cart"></i></a>-->
<!--                                &lt;!&ndash;                                                        <a title="Wishlist" href="#"><i class="icon-like"></i></a>&ndash;&gt;-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
<!--        </div>-->
<!--    </div>-->
    <div class="overview-area bg-img pt-155 pb-135"
         style="background-image:url(/assets/img/banner/hop-banner-5.jpg);">
        <div class="container">
            <div class="row">
                <div class="col-lg-6">
                    <div class="overview-content text-center">
                        <h3>Get <span>26%</span> off</h3>
                        <h2>New friend <br>a great discount</h2>
                        <a th:href="@{/login}">Sign in</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Best Seller Product Area Start Here -->
    <div class="Products-area-wrapper pt-80 pb-87">
        <div class="container">
            <!-- Section Title Start -->
            <div class="section-title text-center mb-45">
                <h2>Adventure starts here - gear up with the best!</h2>
            </div>
            <!-- Section Title End -->
            <!-- Second Featured Product Activation Start -->
            <div class="Products-area">
                <div th:each="category : ${categoryProducts}">
                    <div class="section-title text-center mb-45">
                        <h3 th:text="${category.key.categoryName}" class="mb-10"></h3>
                        <p th:text="${category.key.description}"></p>
                    </div>
                    <div class="row">
                        <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 mb-40" th:each="product: ${category.value}">
                            <!-- Single Product Start -->
                            <div class="single-aboss-product mb-10">
                                <div class="pro-img">
                                    <a th:href="@{/product-details(productId=${product.id})}">
                                        <img th:src="${product.thumbnail != null ? product.thumbnail.filePath : 'default-image.jpg'}"
                                             alt="Product Image">
                                    </a>
                                </div>
                                <div class="pro-content">
                                    <h4><a th:href="@{/product-details(productId=${product.id})}" th:text="${product.name}"></a></h4>
                                    <div class="pro-price-cart">
                                        <div class="pro-home-price">
                                            <span th:text="'$' + ${product.price}"></span>
                                        </div>
                                        <div class="pro-cart">
<!--                                            <a title="Add To Cart" th:href="@{/cart/add(id=${product.id})}"><i class="icon-cart"></i></a>-->
                                            <a  title="Add To Cart" href="javascript:void(0);" class="add-to-cart-btn" th:data-id="${product.id}">
                                                <i class="icon-cart"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- Single Product End -->
                        </div>
                    </div>
                </div>

                <div class="slider-btn mt-75 show-all">
                    <a class="animated" th:href="@{/shop}">See all products <i class="animated icon-right-arrow"></i></a>
                </div>
            </div>
            <!-- Second Featured Product Activation End -->
        </div>
        <!-- Container End -->
    </div>
    <!-- Bradn Area Start Here -->
    <div class="brand pb-90">
        <div class="container">
            <!-- Brand Logo Active Start Here -->
            <div class="section-title text-center mb-45">
                <h2>OUR PARTNERS</h2>
            </div>
            <div class="brand-logo-active brand-brown-color owl-carousel ptb-80 border-top border-bottom">
                <div class="single-brand">
                    <a href="#"><img src="../../assets/img/brand/brand-1.png" alt="brand-image"></a>
                </div>
                <div class="single-brand">
                    <a href="#"><img src="../../assets/img/brand/brand-2.png" alt="brand-image"></a>
                </div>
                <div class="single-brand">
                    <a href="#"><img src="../../assets/img/brand/brand-3.png" alt="brand-image"></a>
                </div>
                <div class="single-brand">
                    <a href="#"><img src="../../assets/img/brand/brand-4.png" alt="brand-image"></a>
                </div>
                <div class="single-brand">
                    <a href="#"><img src="../../assets/img/brand/brand-5.png" alt="brand-image"></a>
                </div>
                <div class="single-brand">
                    <a href="#"><img src="../../assets/img/brand/brand-2.png" alt="brand-image"></a>
                </div>
            </div>
            <!-- Brand Logo Active End Here -->
        </div>
    </div>

    <div class="blog-area pt-0 pb-90">
        <div class="container">
            <div class="section-title text-center mb-45">
                <h2>LATEST NEWS</h2>
            </div>
            <div class="row">
                <div class="col-lg-4 col-md-6 col-sm-12">
                    <div class="news-thumbnail">
                        <div class="blog-img">
                            <a th:href="@{/blog-details}">
                                <img alt="" src="../../assets/img/blog/hop-blog4.jpg">
                            </a>
                        </div>
                        <div class="news-content">
                            <h5><a th:href="@{/blog-details}">Lorem Ipsum</a></h5>
                            <p>There are many variations of passages of Lorem Ipsum available There are many variations
                                of...</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6 col-sm-12">
                    <div class="news-thumbnail">
                        <div class="blog-img">
                            <a th:href="@{/blog-details}">
                                <img alt="" src="../../assets/img/blog/hop-blog4.jpg">
                            </a>
                        </div>
                        <div class="news-content">
                            <h5><a th:href="@{/blog-details}">Lorem Ipsum</a></h5>
                            <p>There are many variations of passages of Lorem Ipsum available There are many variations
                                of...</p>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4 col-md-6 col-sm-12">
                    <div class="news-thumbnail">
                        <div class="blog-img">
                            <a th:href="@{/blog-details}">
                                <img alt="" src="../../assets/img/blog/hop-blog4.jpg">
                            </a>
                        </div>
                        <div class="news-content">
                            <h5><a th:href="@{/blog-details}">Lorem Ipsum</a></h5>
                            <p>There are many variations of passages of Lorem Ipsum available There are many variations
                                of...</p>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Bradn Area End  Here -->
    <div class="newsletter-area bg-img pt-132 pb-165"
         style="background-image:url(/assets/img/banner/hop-banner-6.jpg);">
        <div class="container">
            <div class="row">
                <div class="col-lg-7 col-md-5">
                    <div class="newsletter-content">
                        <h2>Get All Helps <br>& Updates.</h2>
                    </div>
                </div>
                <div class="col-lg-5 col-md-7">
                    <div class="newsletter-style pt-29">
                        <p>Subscribe to our newsletter</p>
                        <div id="mc_embed_signup" class="subscribe-form">
                            <form id="mc-embedded-subscribe-form" class="validate" novalidate="" target="_blank"
                                  name="mc-embedded-subscribe-form" method="post" action="">
                                <div id="mc_embed_signup_scroll" class="mc-form">
                                    <input class="email" type="email" required="" placeholder="Enter your email"
                                           name="EMAIL" value="">
                                    <div class="mc-news" aria-hidden="true">
                                        <input type="text" value="" tabindex="-1"
                                               name="b_6bbb9b6f5827bd842d9640c82_05d85f18ef">
                                    </div>
                                    <div class="clear">
                                        <input id="mc-embedded-subscribe" class="button" type="submit" name="subscribe"
                                               value="Subscribe">
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer-area bg-img" th:replace="~{layout::page_footer}"></footer>
</div>

<th:block th:insert="~{layout :: scripts}"></th:block>


<script>
    document.addEventListener("DOMContentLoaded", function () {
        const checkboxes = document.querySelectorAll(".category-filter");
        const gridView = document.getElementById("grid-view");
        const listView = document.getElementById("list-view");

        // Initialize price range slider
        $("#slider-range").slider({
            range: true,
            min: 0,
            max: 10000,
            values: [0, 10000],
            slide: function (event, ui) {
                $("#amount").val("$" + ui.values[0] + " - $" + ui.values[1]);
            },
            stop: function (event, ui) {
                fetchFilteredProducts();
            }
        });

        $("#amount").val("$" + $("#slider-range").slider("values", 0) +
            " - $" + $("#slider-range").slider("values", 1));

        function fetchFilteredProducts() {
            let selectedCategories = [];
            document.querySelectorAll(".category-filter:checked").forEach((cb) => {
                selectedCategories.push(cb.value);
            });

            let minPrice = $("#slider-range").slider("values", 0);
            let maxPrice = $("#slider-range").slider("values", 1);
            let selectedSortElement = document.querySelector(".option.selected");
            let selectedSort = selectedSortElement ? selectedSortElement.getAttribute("data-value") : "";

            console.log("Fetching products with:", { selectedCategories, minPrice, maxPrice, selectedSort });

            let queryParams = new URLSearchParams();
            if (selectedCategories.length > 0) {
                queryParams.append("categories", selectedCategories.join(","));
            }
            queryParams.append("minPrice", minPrice);
            queryParams.append("maxPrice", maxPrice);
            if (selectedSort) {
                queryParams.append("sort", selectedSort);
            }

            fetch('/filter-products?' + queryParams.toString(), {
                method: 'GET',
                headers: {'Content-Type': 'application/json'}
            })
                .then(response => response.text())
                .then(data => {
                    console.log("Response received, updating UI");
                    document.getElementById("product-container").innerHTML = data;

                    if (gridView.classList.contains("show")) {
                        listView.classList.remove("show", "active");
                        gridView.classList.add("show", "active");
                    } else {
                        gridView.classList.remove("show", "active");
                        listView.classList.add("show", "active");
                    }
                })
                .catch(error => console.error('Error fetching products:', error));
        }

        checkboxes.forEach(checkbox => {
            checkbox.addEventListener("change", fetchFilteredProducts);
        });

        document.getElementById("sort-options").addEventListener("click", function (event) {
            console.log("Sort option clicked:", event.target);

            if (event.target.tagName === "LI") {
                console.log("Clicked on:", event.target.getAttribute("data-value"));

                // Remove 'selected' class from all options
                document.querySelectorAll(".option").forEach(opt => opt.classList.remove("selected"));

                // Add 'selected' class to the clicked option
                event.target.classList.add("selected");

                console.log("Sorting changed to:", event.target.getAttribute("data-value"));

                // Fetch the filtered and sorted products
                fetchFilteredProducts();
            }
        });


    });
</script>
<!-- jquery 3.2.1 -->

<script th:inline="javascript">
    function showToast(message, type = "success") {
        Toastify({
            text: message,
            duration: 2000,
            close: true,
            gravity: "top", // `top` or `bottom`
            position: "center", // `left`, `center` or `right`
            stopOnFocus: true, // Prevents dismissing of toast on hover
            style: {
                background: "linear-gradient(to right, #00b09b, #96c93d)",
            },
            onClick: function(){} // Callback after click
        }).showToast();
    }
    $(document).ready(function () {
        $(document).ready(function () {
            // Fetch cart data when page loads
            function fetchCartData() {
                $.ajax({
                    url: "/cart/data",
                    type: "GET",
                    success: function (response) {
                        console.log("success load page");
                        updateCartCount(response.cartSize);
                        updateCartUI(response.cartItems);
                    },
                    error: function () {
                        console.log("Error fetching cart data");
                    }
                });
            }
            fetchCartData();
        });
        $(document).on("click", ".add-to-cart-btn", function () {
            console.log("addCartFunc")
            let productId = $(this).attr("data-id"); // Ensure correct ID retrieval
            $.ajax({
                type: "POST",
                url: "/cart/add", // Update with your backend API endpoint
                contentType: "application/json",
                data: JSON.stringify({ id: productId }),
                success: function (response) {
                    console.log("success");
                    updateCartCount(response.cartSize); // Update cart count
                    updateCartUI(response.cartItems); // Update cart UI
                    if (response.ErrorMessage != null) {
                        showToast(response.ErrorMessage, "error");
                    }else {
                        showToast("Product added to cart!");
                    }
                },
                error: function () {
                    showToast("Error adding product to cart!", "error");
                }
            });
        });

        function updateCartCount(count) {
            $("#toi-muon-count").text(count); // Update cart count in navbar
        }

        function updateCartUI(cartItems) {
            let cartContainer = $(".ht-dropdown-cart");
            cartContainer.empty();
            let totalPrice = 0;// Clear old items
            cartItems.forEach((item) => {
                let cartHtml = `
                <li class="single-cart-box">
                    <div class="cart-img">
                         <a href="#"><img src="${item.thumbNail}" alt="cart-image"></a>
                        <span class="pro-quantity">${item.quantity}</span>
                    </div>
                    <div class="cart-content">
                        <h6><a href="/product-details">${item.productName}</a></h6>
                        <span class="cart-price">$ ${item.price}</span>
                    </div>
                    <a class="del-icon" href="#"><i class="ion-close"></i></a>
                </li>
            `;
                cartContainer.append(cartHtml);
                totalPrice += item.price*item.quantity;
            });



            let footer = `
                        <!-- Cart Footer Inner Start -->
                        <li class="cart-footer">
                           <ul class="price-content">
                              <li>Total <span>$ ${totalPrice}</span></li>
                           </ul>
                           <div class="cart-actions text-center">
                              <a class="cart-checkout" id="view-cart-btn">View Cart</a>
                           </div>
                        </li>
                        <!-- Cart Footer Inner End -->
                        `;
            cartContainer.append(footer);

        }


        // Handle "View Cart" button click
        $(document).on("click", "#view-cart-btn", function () {
            window.location.href = "/cart"; // Redirect to Thymeleaf cart page
        });
    });

</script>

</body>
</html>